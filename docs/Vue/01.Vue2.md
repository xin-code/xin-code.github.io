---
title: Vue2
date: 2022-03-24 16:13:37
permalink: /pages/vue2/
categories: 
  - Vue2
tags: 
  - 
author: 
  name: Xin
  link: https://github.com/xin-code
---


Vueæ˜“æ··çŸ¥è¯†ç‚¹ä»¥åŠéƒ¨åˆ†é—æ¼çŸ¥è¯†è¿›è¡Œçš„æ¢³ç†æ€»ç»“

<!-- more -->



## ä½¿ç”¨sortæŠ¥é”™

>  `You may have an infinite update loop in a component render function(æ„æ€æ˜¯ï¼šç»„ä»¶æ¸²æŸ“å‡½æ•°ä¸­å¯èƒ½æœ‰ä¸€ä¸ªæ— é™æ›´æ–°å¾ªç¯)`

è§£å†³åŠæ³•:

 ```javascript
return values.slice().sort(...)
 ```





## æŒ‡ä»¤

### v-if / v-show

- v-if 

  - v-if="true" æ’å…¥å…ƒç´ 
  - v-if="false"ç§»é™¤å…ƒç´ 
  - ä¼šæ‘§æ¯æ•´ä¸ªdomå…ƒç´ æ•´ä¸ªæ·»åŠ æˆ–åˆ é™¤

- v-show

  - v-show="true" æ˜¾ç¤º
  - v-show="false"éšè—
  - æœ¬è´¨ä¸Šæ˜¯ä¸ºè¯¥domå…ƒç´ æ·»åŠ ä¸€ä¸ªcsså±æ€§å¹¶åŸºäº `display`è¿›è¡Œåˆ‡æ¢

- æ¶ˆè€—æ–¹é¢ï¼šv-ifæœ‰æ›´é«˜çš„åˆ‡æ¢æ¶ˆè€—ï¼Œv-showæœ‰æ›´é«˜çš„åˆå§‹æ¸²æŸ“æ¶ˆè€—

  ï¼ˆv-if ç›¸æ¯” v-show å¼€é”€æ›´å¤§çš„ï¼ˆå› ä¸ºç›´æ¥æ“ä½œdomèŠ‚ç‚¹å¢åŠ ä¸åˆ é™¤ï¼‰ï¼‰



## import '@...' ä¸­@æŒ‡ä»£

- @ ç­‰ä»·äº `/src` è¿™ä¸ªç›®å½•ï¼Œé¿å…å†™éº»çƒ¦åˆæ˜“é”™çš„ç›¸å¯¹è·¯å¾„



## ç¼©å†™

```vue
:class ç­‰æ•ˆäº v-bind:class
@click ç­‰æ•ˆäº v-on:click
<template #footer ç­‰æ•ˆäº <template v-slot:footer
```



## .nativeä¿®é¥°ç¬¦çš„ä½¿ç”¨

- åœ¨ v-on ï¼ˆ@ï¼‰ä¸Šä½¿ç”¨çš„ä¿®é¥°ç¬¦ .native ç»™å­ç»„ä»¶ç»‘å®šä¸€ä¸ªåŸç”Ÿçš„äº‹ä»¶

  ```vue
  @keyup.enter.native="save"  // å›è½¦è§¦å‘äº‹ä»¶ 'save'
  @click.native="onClickDetail" // ç‚¹å‡»è§¦å‘äº‹ä»¶ 'onClickDetail'
  ```

  

## å…·åæ’æ§½

- çˆ¶ç»„ä»¶

  - ä¸€ä¸ªä¸å¸¦ `name` çš„ `<slot>` å‡ºå£ä¼šå¸¦æœ‰éšå«çš„åå­—â€œdefaultâ€ã€‚

  ```vue
  <div class="container">
    <header>
      <slot name="header"></slot>
    </header>
    <main>
      <slot></slot>
    </main>
    <footer>
      <slot name="footer"></slot>
    </footer>
  </div>
  ```

  

- å­ç»„ä»¶

  ```vue
  <div>
    <template v-slot:header>
    <!-- å¯ç¼©å†™ä¸º#header -->
    <template #header>
      <h1>Here might be a page title</h1>
    </template>
    </template>
  
    <template v-slot:default>
    <!-- å¯ç¼©å†™ä¸º#default -->
    <template #default>
      <p>A paragraph for the main content.</p>
      <p>And another one.</p>
    </template>
    </template>
  
    <template v-slot:footer>
    <!-- å¯ç¼©å†™ä¸º#footer -->
    <template #footer>
      <p>Here's some contact info</p>
    </template>
    </template>
  </div>
  ```

  



## this.$set( target, key, value )

- ä½¿ç”¨åœºæ™¯ï¼šå‘å“åº”å¼å¯¹è±¡æ–°å¢ä¸€ä¸ªå±æ€§ï¼Œå¹¶ç¡®ä¿è¿™ä¸ªæ–°å±æ€§åŒæ ·æ˜¯å“åº”å¼çš„ï¼Œå¯ä»¥è§¦å‘è§†å›¾æ›´æ–°
- å½“ä½¿ç”¨watchæ–¹æ³•æ—¶ï¼Œå¯ä»¥ç”¨è¿™ä¸ªè§¦å‘è§†å›¾æ›´æ–°

```vue
ğŸŒ¹ targetï¼šè¦æ›´æ”¹çš„æ•°æ®æº(å¯ä»¥æ˜¯å¯¹è±¡æˆ–è€…æ•°ç»„)
ğŸŒ¹ keyï¼šè¦æ›´æ”¹çš„å…·ä½“æ•°æ®(indexå€¼)
ğŸŒ¹ value ï¼šé‡æ–°èµ‹çš„å€¼
```



## é¡µé¢ç›‘æ§é¼ æ ‡ç‚¹å‡»äº‹ä»¶

1. æ·»åŠ ç›‘å¬

   ```vue
   mounted () {
       window.addEventListener('click', this.handleClick, true);
   },
   ```

2. æ–¹æ³•è°ƒç”¨

   ```vue
   methods:{
       //  ç‚¹å‡»äº‹ä»¶
       handleClick(e){
           console.log(e)
       },
   }
   ```

3. ç§»é™¤ç›‘æ§

   ```vue
     destroyed() {
       window.removeEventListener('click', this.handleClick, true);
     },
   ```




## ä¸‹è½½æ–‡ä»¶

- æ–‡ä»¶æµ

  ```javascript
      let elink = document.createElement('a');
  	// æ ¹æ®åç«¯è¿”å›çš„åå­—å‘½å
  	let name = res.headers['content-disposition'];
  	const fileName = `${decodeURI(name.split(';')[1].split('=')[1])}`;
      elink.download = `${fileName}`;
      elink.style.display = 'none';
      let blob = new Blob([res]);
      elink.href = URL.createObjectURL(blob);
      document.body.appendChild(elink);
      elink.click();
      document.body.removeChild(elink);
  ```

- æ–‡ä»¶é“¾æ¥

  ```javascript
        let link = document.createElement('a');
        link.style.display = 'none';
        link.href = 'xxxx.doc';
        link.setAttribute('download', name);
        document.body.appendChild(link);
        link.click();
  ```




## ä¸‹è½½æ–‡ä»¶æ‰“ä¸å¼€

- è§£å†³åŠæ³•:

  - åœ¨è¯·æ±‚æ—¶æ·»åŠ 

  ```javascript
  responseType: 'blob'
  ```

  



## mixins

mixinsï¼ˆæ··å…¥ï¼‰ï¼Œæ˜¯ä¸€ä¸ªjså¯¹è±¡ï¼Œå®ƒå¯ä»¥åŒ…å«æˆ‘ä»¬ç»„ä»¶ä¸­scripté¡¹ä¸­çš„ä»»æ„åŠŸèƒ½é€‰é¡¹ï¼Œå¦‚dataã€componentsã€methods ã€createdã€computedç­‰ç­‰ã€‚æˆ‘ä»¬åªè¦å°†å…±ç”¨çš„åŠŸèƒ½ä»¥å¯¹è±¡çš„æ–¹å¼ä¼ å…¥ mixinsé€‰é¡¹ä¸­ï¼Œå½“ç»„ä»¶ä½¿ç”¨ mixinså¯¹è±¡æ—¶æ‰€æœ‰mixinså¯¹è±¡çš„é€‰é¡¹éƒ½å°†è¢«æ··å…¥è¯¥ç»„ä»¶æœ¬èº«çš„é€‰é¡¹ä¸­æ¥ï¼Œè¿™æ ·å°±å¯ä»¥æé«˜ä»£ç çš„é‡ç”¨æ€§ï¼Œä½¿ä½ çš„ä»£ç ä¿æŒå¹²å‡€å’Œæ˜“äºç»´æŠ¤ã€‚

```vue
<script>
export default {
  props: {
  },
  data () {
    return {
      pagination: {
        list: [], // åˆ†é¡µæ•°æ®(required)
        currentPage: 1, // å½“å‰é¡µç (required)
        total: 0, // æ€»æ•°(required)
        pageSize: 50, // åˆ†é¡µæ•°è®¾å®šå€¼
        size: 0, // åˆ†é¡µæ•°å®é™…å€¼(æ¯”å¦‚è®¾å®špageSizeä¸º10ï¼Œä½†æœ€åä¸€é¡µåªæœ‰7æ¡è®°å½•ï¼Œsizeä¸º7)
        pages: 1, // æ€»é¡µæ•°
        startRow: 0, // å½“å‰èµ·å§‹ç´¢å¼•
        endRow: 0, // å½“å‰ç»“å°¾ç´¢å¼•
      },
    }
  },
  computed: {
  },
  methods: {
    // å…¬å…±æ–¹æ³• ç¿»é¡µ
    togglePage (page) {
      this.pagination.currentPage = page
      this.query()
    },
    // å…¬å…±æ–¹æ³• åˆ†é¡µå¤§å°ä¿®æ”¹
    changePageSize (pageSize) {
      this.pagination.pageSize = pageSize
      this.query()
    },
  },
}
</script>
<style lang="scss" rel="stylesheet/scss" scoped>
</style>

```



- ä½¿ç”¨

```vue
<template>
  <div class="flex-column flex-ai-stretch">
    <operation
      @query="query"
      class="flex-none"
    />
    <data-table
      :pagination="pagination"
      @togglePage="togglePage"
      @changePageSize="changePageSize"
      class="flex-auto"
    />
  </div>
</template>

<script>
import PagingData from '@/components/pagination/PagingData'
import Operation from './Operation'
import DataTable from './DataTable'
import * as adApi from '@/api/ad-api/ad'

export default {
  // æ··å…¥ PagingData
  mixins: [PagingData],
  components: {
    Operation,
    DataTable,
  },
  props: {},
  data () {
    return {
      queryParams: null,
    }
  },
  computed: {},
  methods: {
    async query (queryParams) {
      if (queryParams) {
        // æŸ¥è¯¢æ¡ä»¶æœ‰å˜åŠ¨ï¼Œé¡µç å½’é›¶
        this.queryParams = queryParams
        this.pagination.currentPage = 1
      }
      // å°è£…çš„APIæ–¹æ³•
      const res = await adApi.listChildren(this.queryParams, this.pagination)
      Object.assign(this.pagination, res)
    },
  },
  watch: {},
  created () {},
}
</script>

<style lang="scss" scoped>

</style>

```



## v-on="$listeners" ã€è‡ªä¸‹å‘ä¸Šä¼ é€’äº‹ä»¶ã€‘

@click ç­‰æ•ˆäº v-on:click (äº‹ä»¶)

çˆ¶ã€å­ã€å­™ éš”ä»£é€šè®¯ä¸­ä½¿ç”¨

å­™ï¼ˆ$emitï¼‰â†’å­ï¼ˆ$emitï¼‰â†’çˆ¶ï¼Œè¦ä½¿ç”¨ä¸¤æ¬¡$emit ä¼ é€’äº‹ä»¶ï¼Œæ‰èƒ½ä¼ é€’åˆ°`çˆ¶`ç»„ä»¶

åœ¨ä¸­é—´ç»„ä»¶ã€å­ç»„ä»¶ã€‘ä¸­ä½¿ç”¨å³å¯ï¼Œçœå»å†æ¬¡ä¼ é€’çš„è¿‡ç¨‹

```vue
<template>
  <Son v-on="$listeners"/>
</template>
```

çˆ¶ç»„ä»¶ç›´æ¥å¯ä»¥ç›´æ¥ä½¿ç”¨@æ–¹æ³•å

```vue
<template>
  <Father @Msg='Msg'/>
</template>
 
methods:{
  Msg(val){
    console.log(val) //ä»å­™ç»„ä»¶($emit)ä¼ é€’è¿‡æ¥çš„æ–¹æ³•
  }
}
```



## v-bind="$attrs" ã€è‡ªä¸Šå‘ä¸‹ä¼ é€’å€¼ã€‘

:class ç­‰æ•ˆäº v-bind:class (ä¼ å€¼)

çˆ¶ã€å­ã€å­™ éš”ä»£é€šè®¯ä¸­ä½¿ç”¨

çˆ¶ï¼ˆ:content="å†…å®¹"ï¼‰â†’å­ï¼ˆ:content="å†…å®¹"ï¼‰â†’å­™ï¼Œè¦ä½¿ç”¨ä¸¤æ¬¡contentï¼Œæ‰èƒ½ä¼ é€’åˆ°`å­™`ç»„ä»¶

åœ¨ä¸­é—´ç»„ä»¶ã€å­ç»„ä»¶ã€‘ä¸­ä½¿ç”¨å³å¯ï¼Œçœå»å†æ¬¡ä¼ é€’çš„è¿‡ç¨‹

```vue
<template>
  <Son v-bind="$attrs"/>
</template>
```

å­™ç»„ä»¶ç›´æ¥propsæ¥æ”¶å³å¯

```vue
<template>
  <div>çˆ¶ä¼ é€’è¿‡æ¥çš„å€¼:{{content}}</div>
</template>
 
<script>
export default {
  name: 'grandson',
  props: {
    content:{ //æ¥æ”¶çˆ¶ä¼ é€’çš„content
      type:String,
      default:''
    }
  },
}
</script>
```



## EventBus

<font color='red'>äº‹ä»¶æ€»çº¿</font>ï¼Œç›¸å½“äºä¸€ä¸ªå…¨å±€çš„ä»“åº“ï¼Œä»»ä½•ç»„ä»¶éƒ½å¯ä»¥å»è¿™ä¸ªä»“åº“é‡Œè·å–äº‹ä»¶ã€‚ä¸»è¦ç”¨äºç»„ä»¶ä¹‹é—´çš„ä¼ å€¼ï¼Œä¾‹å¦‚ï¼šå…„å¼Ÿä¼ å€¼

1ã€åœ¨main.jsä¸­å…¨å±€åˆå§‹åŒ–`EventBus`

```vue
Vue.prototype.$EventBus = new Vue()
```

2ã€åœ¨Aç»„ä»¶ä¸­å‘`EventBus`å‘é€äº‹ä»¶

```vue
this.$EventBus.$emit("msg", '123');
```

3ã€åœ¨Bç»„ä»¶ä¸­æ¥æ”¶äº‹ä»¶

```vue
 mounted() {
    this.$EventBus.$on("msg", (data) => {
      this.msg = data;
    });
 }
```

4ã€ç§»é™¤ç›‘å¬

ä¸Šè¿°ä¸‰æ­¥ä¸­Aç»„ä»¶å‘Bç»„ä»¶è¿›è¡Œä¼ é€’äº†æ•°æ®ï¼Œä½†å½“ç¦»å¼€Bç»„ä»¶å†æ¬¡è¿›å…¥Bç»„ä»¶æ—¶ï¼Œæ—¶é—´æ€»çº¿é‡Œå°±æœ‰å¤šä¸ªç›‘å¬ï¼Œä¼šå¯¼è‡´äº‹ä»¶åªè§¦å‘äº†ä¸€æ¬¡ï¼Œä½†ç›‘å¬äº‹ä»¶ä¸­çš„å›è°ƒå‡½æ•°æ‰§è¡Œäº†å¾ˆå¤šæ¬¡ï¼Œæ‰€ä»¥åœ¨ç»„ä»¶ç¦»å¼€å‰ï¼Œä¹Ÿå°±æ˜¯è¢«é”€æ¯å‰ï¼Œéœ€è¦å°†è¯¥ç›‘å¬äº‹ä»¶ç»™ç§»é™¤ï¼Œä»¥å…ä¸‹æ¬¡å†é‡å¤åˆ›å»ºç›‘å¬ã€‚

```vue
// ç¦»å¼€Bç»„ä»¶çš„æ—¶å€™ç§»é™¤
beforeDestroy(){
    //ç§»é™¤ç›‘å¬äº‹ä»¶"msg"
    this.$EventBus.$off("msg")
}
```





## Vuex

Vuex æ˜¯ä¸€ä¸ªä¸“ä¸º Vue.js åº”ç”¨ç¨‹åºå¼€å‘çš„**çŠ¶æ€ç®¡ç†æ¨¡å¼**ã€‚å®ƒé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ï¼Œå¹¶ä»¥ç›¸åº”çš„è§„åˆ™ä¿è¯çŠ¶æ€ä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚

- state

  å…³é”®è¯:`å•ä¸€çŠ¶æ€æ ‘`,`å­˜å‚¨`,`å…±äº«æ•°æ®`

  <span style="color:red">ä½¿ç”¨:</span>

  - this.$store.state['å±æ€§å']

  - ```vue
    import { mapState } from 'vuex'
    
    computed: {
        ...mapState({
    	// å†™æ³•ä¸€:ç®­å¤´å‡½æ•° å¯ä»¥é‡å‘½ååç§°ä¸ºxxa
          xxa: state => state.xx,
    	// å†™æ³•äºŒ:ä¼ å­—ç¬¦ä¸²ç­‰åŒäº state => state.aa,
    	  aa:'aa',
        }),
    	// å†™æ³•ä¸‰:ç¼©å†™ï¼Œåœ¨æ— éœ€é‡å‘½åçš„æƒ…å†µä¸‹ï¼Œç›´æ¥å¯ä»¥ä½¿ç”¨stateé‡Œçš„åç§°
       ...mapState(['ccc']),
    }
    ```

- getters

  å…³é”®è¯:`è®¡ç®—å±æ€§`,`å…¬å…±å‡½æ•°`,`stateå‘ç”Ÿå˜åŒ–é‡æ–°è®¡ç®—`

  - vuexä¸­ä½¿ç”¨

    ```
    getters: {
      	// ç¬¬ä¸€ä¸ªå‚æ•° state
        getName: (state) => {
          return state.name ? 'æå››' : 'ç‹äº”'
        }
        // state å’Œ getters
        getNameType: (state,getters) => {
        	return typeof getters.getName
        }
        // å¯ä»¥ä¼ é€’ç”¨æˆ·è‡ªå®šä¹‰çš„å€¼ è®©å‡½æ•°è¿”å›å¦ä¸€ä¸ªå‡½æ•°
        getNameDefault (state) {
          return function (name) {
            return state.name ? name : 'xxx'
          }
        }
      },
    ```
  
    
  
  <span style="color:red">ä½¿ç”¨:</span>
  
  - this.$store.getters['å±æ€§å']
  
  - ```vue
    import { mapGetters } from 'vuex'
    
    computed: {
        ...mapState({
    	// å†™æ³•ä¸€:é‡å‘½åçš„æƒ…å†µä¸‹aab
    	  aab:'aa',
        }),
    	// å†™æ³•äºŒ:ç¼©å†™ï¼Œè®¡ç®—å±æ€§çš„åç§°ä¸ getters çš„å­èŠ‚ç‚¹åç§°ï¼Œæ— éœ€é‡å‘½åçš„æƒ…å†µä¸‹ã€‚
       ...mapState(['ccc']),
    }
    ```
  



- mutations

  å…³é”®è¯:`æ”¹å˜stateä¸­çŠ¶æ€çš„å”¯ä¸€æ–¹æ³•`ï¼Œ`å¤„ç†æ•°æ®é€»è¾‘`

  - vuexä¸­ä½¿ç”¨

  ```vue
    mutations: {
      // é»˜è®¤ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºstate ç¬¬äºŒä¸ªä¸ºpayload(è½½è·)
      changeName (state, name) {
        state.name = name
      },
      changeAge (state, age) {
        state.age = age
      },
  	// å¯ä»¥åŒæ—¶ä¿®æ”¹ä¸¤ä¸ªæ•°æ®
      changeUserInfo (state, info) {
        this.commit('changeName',info.name)
        this.commit('changeAge',info.age)
      }
    },
  ```

  <span style="color:red">ä½¿ç”¨:</span>

  - this.$store.commit('xxx',[xxx])

  - ```vue
    import { mapMutations } from 'vuex'
    
    methods: {
    	// æ›´æ–° vuex state
    	// å¯ä»¥ç›´æ¥è°ƒç”¨æ–¹æ³•
    	...mapMutations(['changeName','changeUserInfo']),
    	
    	// å•ä¸ªç”¨æˆ·ä¿¡æ¯
    	onClickChangeName(){
    		// ç›´æ¥è°ƒç”¨mutationsæ–¹æ³•
    		this.changeName('AAA')
    	},
    	
    	changeUserInfo(){
    		// æ”¹å˜ç”¨æˆ·ä¿¡æ¯
    		this.changeUserInfo({
    			name:'YYY',
    			age:99,
    		})
    	}
    }
    ```



- actions

  å…³é”®è¯:`å¼‚æ­¥`,`æäº¤ç»™mutation`

- modules

  å…³é”®è¯:`åˆ†å‰²`,`æ¨¡å—`



## VuexæŒä¹…åŒ–æ’ä»¶

- å½“é¡µé¢åˆ·æ–°åï¼ŒVuexæ•°æ®ä¼šæ¸…ç©º

```shell
npm i vuex-persistedstate
```

- åœ¨Vuexé¡µé¢ æ·»åŠ `plugins`

```vue
export default new Vuex.Store({
  state: {
  },
  getters: {
  },
  mutations: {
  },
  actions: {
  },
  modules: {
  },
  plugins: [createPersistedState()]
})
```







## ä»£ç æ‰“åŒ…

- source Map

  ä¸€ä¸ªä¿¡æ¯æ–‡ä»¶ï¼Œç”¨äºå­˜å‚¨ä»£ç è¡Œçš„ä½ç½®ï¼Œåœ¨å‹ç¼©ä»£ç åï¼Œæµè§ˆå™¨ä¾ç„¶å¯ä»¥æ˜¾ç¤ºåŸå§‹ä»£ç è¡Œçš„ä½ç½®

  ```js
  æ–‡ä»¶:vue.config.js
  module.exports = {
      productionSourceMap: false, // ä¸ä½¿ç”¨sourceMap æé«˜æ„å»ºé€Ÿåº¦
      productionSourceMap: true, // ä½¿ç”¨sourceMap æŠ¥é”™åå¯ä»¥å®šä½åŸå§‹ä»£ç è¡Œä½ç½®
  }
  ```






## F12 ä¸æ˜¾ç¤ºVueæ’ä»¶

1. F12ä¸æ˜¾ç¤ºVueæ’ä»¶ å¹¶ä¸” ç‚¹å‡»æ‰©å±•ç¨‹åºæ˜¾ç¤º 'Devtools inspection is not available because it's in production mode or explicitly disabled by the author.'
2. å¯èƒ½Vueä¸æ˜¯ç”Ÿäº§ç¯å¢ƒæˆ–è€…å‹ç¼©ç‰ˆ

- å¯ä»¥åœ¨`main.js`æ–‡ä»¶ä¸­æ·»åŠ 

  ```javascript
  Vue.config.devtools = true;
  ```

- åˆ·æ–°ç½‘é¡µå³å¯æ˜¾ç¤º