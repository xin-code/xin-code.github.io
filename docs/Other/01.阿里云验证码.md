---
title: 阿里云验证码
date: 2022-03-24 17:59:50
sticky: false
permalink: /pages/356df5/
categories: 
  - Other
tags: 
  - Other
author: 
  name: Xin
  link: https://github.com/xin-code
---

登陆模块中的验证码模块

![阿里云验证码登陆验证.png](https://s2.loli.net/2022/03/24/r3VTpzDX9oLhZB2.png)

<!-- more -->



## 组件模块

```vue
<!--阿里云 滑块验证码区域-->
<template>
  <div>
    <span id="nc" />
  </div>
</template>

<script>
import './awsc'
export default {
  name: 'NoCaptcha',
  // 验证成功后，服务端报错（如账号/密码等错误），需要重置滑块
  props: {
    reload: {
      type: Boolean,
      default: false,
    },
  },
  data () {
    return {
      nc: '', // noCaptcha实例
    }
  },
  watch: {
    reload: {
      handler (newVal, oldVal) {
        if (newVal) {
          this.nc.reset() // 重置滑块
        }
      },
    },
  },
  mounted () {
    this.init() // 初始化方法
  },
  methods: {
    init () {
      // 实例化nc
      /* eslint-disable */
      AWSC.use('nc', (state, module) => {
        // 初始化
        this.nc = module.init({
          // 您可以在阿里云验证码控制台的配置管理页签找到对应的appkey字段值，请务必正确填写。
          appkey: 'XXX',
          // 您可以在阿里云验证码控制台的配置管理页签找到对应的scene值，请务必正确填写。
          scene: 'xxx',
          // 滑块渲染的DOM id。
          renderTo: 'nc',
          // 滑动条的宽度（单位：px）。默认值为300，建议您为滑动条预留300px以上的宽度。
          width:'400',
          // 您可以在该回调参数中将会话ID（sessionId）、签名串（sig）、请求唯一标识（token）字段记录下来，随业务请求一同发送至您的服务端调用验签。
          success:(data)=> {
            this.$emit('slideCallback', data)
          },
          // 滑动验证失败时触发该回调参数。
          fail:(failCode) => {
            console.log(failCode)
          },
          // 验证码加载出现异常时触发该回调参数。
          error:(errorCode) => {
            console.log(errorCode)
          },
        })
      })
    },
  },
}
</script>

<style lang="scss" rel="stylesheet/scss" scoped>
</style>

```





## 引用组件

```vue
<template>
  // 其他代码略
  <NoCaptcha @slideCallback="finishSlide" :reload="reload" />
</template>

<script>
// 其他代码略
import NoCaptcha from '@/components/NoCaptch.vue';

data() {
  return {
    reload: false,
  }
},
method: {
  // 点击登录
  login() {
    // 验证略
    this.reload = false; // 验证通过后，重置滑块设置为false
    // 后端登录接口
    xx()
    .then(() => {
       // 登录成功代码略
    })
    .catch((err) => {
       // 其他代码略
       this.reload = true; // 需要重置滑块
       errorMsg(err || '该用户无菜单权限，请联系管理员'); // 错误提示
    });
  },
  // 完成滑动
  finishSlide(data) {
    // 按需使用返回值
    console.log('会话ID', data.sessionId)
    console.log('签名串', data.sig)
    console.log('滑块请求的token', data.token)
  },
}
</script>
```

