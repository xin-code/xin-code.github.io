---
title: JS处理数据
date: 2022-03-24 10:21:02
sticky: false
permalink: /pages/dcd28e/
categories:
  - JavaScript
tags:
  -
author:
  name: Xin
  link: https://github.com/xin-code
---

此文档总结整理在工作中出现的部分 JavaScript 常见的处理逻辑

<!-- more -->

## 改变数组中 value、key 值

```javascript
let arr = [
  { mz: "张三", nl: 20 },
  { mz: "李四", nl: 18 },
  { mz: "王五", nl: 33 },
];
const newArr = arr.map((item) => {
  return {
    name: item.mz,
    age: item.nl,
  };
});

console.log(newArr)[
  ({
    name: "张三",
    age: 20,
  },
  {
    name: "李四",
    age: 18,
  },
  {
    name: "王五",
    age: 33,
  })
];
```

## 对象变数组

```javascript
let data = {
  张三: { age: 10, sex: "男" },
  李四: { age: 12, sex: "女" },
};

let Array = Object.keys(data).map((key) => {
  return {
    name: key,
    ...data[key],
  };
});

console.log(Array)[
  // 变为下列的数组
  ({
    name: "张三",
    age: 10,
    sex: "男",
  },
  {
    name: "李四",
    age: 12,
    sex: "女",
  })
];
```



## 为数组内每个对象添加属性

- for循环

  ```javascript
  let arr = [
     {a:1,b:2},  
     {a:3,b:4},
     {a:5,b:6},
     {a:7,b:8},
  ];
  for(let i = 0; i < arr.length; i++){
      arr[i].c = 9
  };
  console.log(arr);
  ```

- Es6 map方法

  ```javascript
  let arr = [
      {a:1,b:2},  
      {a:3,b:4},
      {a:5,b:6},
      {a:7,b:8},
  ];
  let newarr = [];
  arr.map((item,index)=>{
      newarr.push(Object.assign(item,{c:9}))
  })
  arr = newarr;
  console.log(arr)
  ```





## 对比两个数组 删除相同的id

```javascript
a2.forEach((item)=>{
    a1.forEach((ele,i)=>{
        // 比较a1和a2，如果a1里面的数据a2中已经存在了，就删除
        if(item.id==ele.id ){
            // delete a1[i]
            a1.splice(i, 1);
        }
    })
})

// 比较完成后，合并到a2里面
a2 = a2.concat(a1)
console.log(a2)
```





## 定时器

- SetTimeOut()

  ```javascript
  // 定时器
  setTimeout(() => {
    this.方法名();
  }, 200);
  ```

## 日期

1. 获取当前时间是年内第几周

```javascript
/**
 *获取某年某月某天是第几周
 *第一天为周日
 */
getWeekNumber(y, m, d) {
    var targetDay = new Date(y, m - 1, d);
    var year = targetDay.getFullYear();
    var month = targetDay.getMonth();
    var days = targetDay.getDate();
    //那一天是那一年中的第多少天
    for (var i = 1; i < m; i++) {
        days += this.getMonthDays(year, i);
    }
    //那一年第一天是星期几
    var yearFirstDay = new Date(year, 0, 1).getDay();
    //计算是第几周
    days += yearFirstDay;
    var week = Math.ceil(days / 7);
    return week;
}

/**
 *判断年份是否为润年
 */
isLeapYear(year) {
    return (year % 400 == 0) || (year % 4 == 0 && year % 100 != 0);
}
/**
 *获取某年某月的天数
 */
getMonthDays(year, month) {
    return [31, (this.isLeapYear(year) ? 29 : 28), 31, 30, 31, 30, 31, 31, 30, 31, 30, 31][month - 1];
}
```

2. 去除日月前的 0

```javascript
// 去除0 参数 日期 如 2020-07-08 返回为 2020-7-8
dislodgeZero(str) {
	let strArray = str.split("-");
	strArray = strArray.map((val)=> {
		if (val[0] == "0") {
			return (val = val.slice(1));
		} else {
			return val;
		}
	});
      return strArray.join("-");
}
```

3. 将时间戳转化为转为本地时间(去除 TZ)

```
// inputTime 为 13 位（毫秒级）
function formatTimeStamp(inputTime){
	if(!inputTime && typeof inputTime !== 'number'){
		return '';
	}
	var localTime = '';
	inputTime = new Date(inputTime).getTime();
	const offset = (new Date()).getTimezoneOffset();
	localTime = (new Date(inputTime - offset * 60000)).toISOString();
	localTime = localTime.substr(0, localTime.lastIndexOf('.'));
	localTime = localTime.replace('T', ' ');
	return localTime;
}
```

4. 时间戳转为`yyyy-MM-DD HH:mm:ss`

```javascript
function formatDateTime(inputTime) {
  var date = new Date(inputTime);
  var y = date.getFullYear();
  var m = date.getMonth() + 1;
  m = m < 10 ? "0" + m : m;
  var d = date.getDate();
  d = d < 10 ? "0" + d : d;
  var h = date.getHours();
  h = h < 10 ? "0" + h : h;
  var minute = date.getMinutes();
  var second = date.getSeconds();
  minute = minute < 10 ? "0" + minute : minute;
  second = second < 10 ? "0" + second : second;
  return y + "-" + m + "-" + d + " " + h + ":" + minute + ":" + second;
}
```

## 轮询定时器

- beforeMount()

  页面 Mount 前，摧毁定时器

  ```js
    beforeMount(){
      console.log('beforeMount,摧毁定时器');
      clearInterval(this.timer);
    },
  ```

- mounted()

  请求状态接口

  ```js
    mounted () {
      this.calcStatus();
    },
  ```


    methods:{
      // 计算状态
      calcStatus(){
        this.getStatus().then(res => {
          if (res.data.code === 200) {
            this.loadingText = '正在计算'+res.data.data.month+'月方式，请稍后！'
    
            // res.data.data
            // true 未在计算中 false 在计算中
            if(res.data.data.status){
              console.log(`当前后端返回值:[${res.data.data.status}] 未在计算中`);
              // 如果未在计算中，则可以请求页面数据
              this.list();   // 表格数据
              clearInterval(this.timer);
            }else{
              if(!this.timer){
                this.timer = setInterval(() => { console.log('20秒刷新一次计算状态'); this.calcStatus() }, 20000)
              }
            }
          }
        });
      },
    },
  ```

- destroyed()

  离开页面时，摧毁定时器

  ```js
    destroyed(){
      console.log('离开页面,摧毁定时器');
      clearInterval(this.timer);
    },
  ```

## 阿拉伯数字转中文 (例:1 转一)

```js
    //数字转中文
    toChinesNum(num) {
      let changeNum = ['零', '一', '二', '三', '四', '五', '六', '七', '八', '九']
      let unit = ['', '十', '百', '千', '万']
      num = parseInt(num)
      let getWan = (temp) => {
        let strArr = temp.toString().split('').reverse()
        let newNum = ''
        let newArr = []
        strArr.forEach((item, index) => {
          newArr.unshift(item === '0' ? changeNum[item] : changeNum[item] + unit[index])
        })
        let numArr = []
        newArr.forEach((m, n) => {
          if (m !== '零') numArr.push(n)
        })
        if (newArr.length > 1) {
          newArr.forEach((m, n) => {
            if (newArr[newArr.length - 1] === '零') {
              if (n <= numArr[numArr.length - 1]) {
                newNum += m
              }
            } else {
              newNum += m
            }
          })
        } else {
          newNum = newArr[0]
      }
      return newNum
    }
    let overWan = Math.floor(num / 10000)
    let noWan = num % 10000
    if (noWan.toString().length < 4) {
      noWan = '0' + noWan
    }
    return overWan ? getWan(overWan) + '万' + getWan(noWan) : getWan(num)
  },
```

## 验证手机号

```javascript
//JS使用正则表达式校验电话号码
function checkModbile(mobile) {
  var re = /^1[3,4,5,6,7,8,9][0-9]{9}$/;
  var result = re.test(mobile);
  if (!result) {
    alert("手机号码格式不正确！");
    return false; //若手机号码格式不正确则返回false
  }
  return true;
}
```
